# Implementation Plan: MenuMaker MVP

**Branch**: `001-menu-maker` | **Date**: 2025-11-10 | **Spec**: `specs/001-menu-maker/spec.md`  
**Input**: Feature specification from `specs/001-menu-maker/spec.md`

---

## Summary

MenuMaker is a web-first platform (with future mobile app support) enabling home food business owners to create weekly menus, accept orders, and manage payouts. The MVP focuses on rapid onboarding (< 10 min), shareable menus with social preview, and manual order/payment flows. Technical approach: React PWA frontend + Node.js/Fastify backend + Postgres DB, deployed on Heroku/Render for predictable costs at launch.

---

## Technical Context

**Language/Version**: TypeScript 5.x (Node.js 20 LTS)  
**Primary Dependencies**:
- Backend: Fastify, Zod (validation), TypeORM (ORM), JWT (auth)
- Frontend: React 19, TypeScript, TailwindCSS, Vite, Playwright (e2e)
- Database: PostgreSQL 15+
- Storage: S3-compatible (MinIO dev, AWS S3 prod)

**Storage**: PostgreSQL (managed Heroku/Render), S3-compatible object store for images  
**Testing**: Jest (unit/integration), Playwright (e2e), contract tests via OpenAPI schema validation  
**Target Platform**: Web PWA (mobile-responsive); future mobile apps via React Native or Flutter  
**Project Type**: Monorepo (backend + frontend + shared types)  
**Performance Goals**: LCP < 2s, API p95 < 200ms, Lighthouse > 90  

---

## Constitution Check

Verify alignment with project principles (`memory/constitution.md`):

| Principle | Status | Notes |
|-----------|--------|-------|
| **Type Safety** | âœ… Met | TypeScript strict mode; Zod for runtime validation |
| **Testing Standards** | âœ… Met | Unit (Jest) + contract + e2e (Playwright); > 70% coverage target |
| **UX Consistency** | âœ… Met | PWA first; mobile-friendly forms; < 10 min onboarding |
| **Performance** | âœ… Met | LCP < 2s target; Vite for fast HMR |
| **Security & Compliance** | âœ… Met | HTTPS, JWT, input validation; manual payment only (no PCI burden) |
| **Development Velocity** | âœ… Met | Monorepo with shared types; Fastify for fast iteration |

---

## Project Structure

### Documentation (this feature)

```text
specs/001-menu-maker/
â”œâ”€â”€ spec.md                 # Feature specification (this project)
â”œâ”€â”€ plan.md                 # Implementation plan (this file)
â”œâ”€â”€ research.md             # Technology decisions & justifications
â”œâ”€â”€ data-model.md           # Entities, relationships, schemas
â”œâ”€â”€ quickstart.md           # Acceptance scenarios & smoke tests
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ api.openapi.yaml    # OpenAPI v3 schema for all endpoints
â”‚   â””â”€â”€ social-preview.schema.json  # Template schema for social images
â””â”€â”€ tasks.md                # Detailed task breakdown (generated by /speckit.tasks)
```

### Source Code (monorepo)

```text
menumaker/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ models/         # TypeORM entities (User, Business, Dish, etc.)
â”‚   â”‚   â”œâ”€â”€ services/       # Business logic (OrderService, MenuService, etc.)
â”‚   â”‚   â”œâ”€â”€ routes/         # Fastify route handlers (organized by domain)
â”‚   â”‚   â”œâ”€â”€ middleware/     # Auth, error handling, logging
â”‚   â”‚   â”œâ”€â”€ utils/          # Validation (Zod schemas), helpers
â”‚   â”‚   â””â”€â”€ main.ts         # Fastify server entry
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ unit/           # Business logic & service tests (Jest)
â”‚   â”‚   â”œâ”€â”€ contract/       # API endpoint schema validation
â”‚   â”‚   â””â”€â”€ integration/    # End-to-end workflows
â”‚   â”œâ”€â”€ migrations/         # Database schema (TypeORM or Flyway)
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # React components (forms, lists, cards)
â”‚   â”‚   â”œâ”€â”€ pages/          # Routes (Onboarding, Dashboard, PublicMenu, etc.)
â”‚   â”‚   â”œâ”€â”€ services/       # API client (fetch wrapper, retry logic)
â”‚   â”‚   â”œâ”€â”€ types/          # Shared TypeScript types (from backend)
â”‚   â”‚   â”œâ”€â”€ styles/         # TailwindCSS config, global styles
â”‚   â”‚   â””â”€â”€ main.tsx        # React entry & root route
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ e2e/            # Playwright tests (critical flows)
â”‚   â”‚   â””â”€â”€ unit/           # Component unit tests
â”‚   â”œâ”€â”€ public/             # Static assets (favicon, manifest.json for PWA)
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ shared/                 # (Optional) Shared TypeScript types, validators
â”œâ”€â”€ .github/workflows/      # CI/CD: lint, test, deploy
â”œâ”€â”€ docker-compose.yml      # Local dev: Postgres + MinIO
â”œâ”€â”€ .env.example            # Template for environment variables
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## Technology Rationale

| Decision | Choice | Why |
|----------|--------|-----|
| **Backend Runtime** | Node.js 20 LTS | Fast iteration, wide library support, easy async/await |
| **Web Framework** | Fastify | Lightweight, high-performance, excellent TypeScript support |
| **Validation** | Zod | Runtime type validation, excellent error messages for users |
| **ORM** | TypeORM | Mature, PostgreSQL support, migration support |
| **Auth** | JWT + email/password | Simple, scalable, no third-party dependency at MVP |
| **Frontend** | React + TypeScript | Type-safe components, large ecosystem, PWA support |
| **Styling** | TailwindCSS | Rapid UI iteration, built-in dark mode, mobile-first |
| **Bundler** | Vite | Fast HMR, optimized builds, PWA plugin support |
| **Database** | PostgreSQL | Mature, reliable, managed options available (Heroku, Render) |
| **Storage** | S3-compatible | MinIO for dev, AWS S3 for prod; decoupled from main DB |
| **Testing** | Jest + Playwright | Jest for unit/integration, Playwright for e2e + visual testing |
| **Hosting (MVP)** | Heroku/Render | Predictable monthly cost, managed DB, easy deploy, scale later |
| **CI/CD** | GitHub Actions | Free, GitHub-native, extensive community integrations |

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser (PWA) â€” React + TailwindCSS + TypeScript                â”‚
â”‚ â”œâ”€ Onboarding flow (signup, login, business profile)            â”‚
â”‚ â”œâ”€ Seller Dashboard (menu editor, orders, reports)              â”‚
â”‚ â”œâ”€ Public Menu (shareable link for customers)                   â”‚
â”‚ â””â”€ Order Form (customer checkout)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTPS (API calls)
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fastify API Server (Node.js + TypeScript)                       â”‚
â”‚ â”œâ”€ /auth/* (signup, login, logout, password reset)              â”‚
â”‚ â”œâ”€ /businesses/* (profile, settings, delivery rules)            â”‚
â”‚ â”œâ”€ /dishes/* (CRUD dishes)                                      â”‚
â”‚ â”œâ”€ /menus/* (CRUD menus, public menu endpoint)                  â”‚
â”‚ â”œâ”€ /orders/* (create order, view orders, update status)         â”‚
â”‚ â”œâ”€ /media/* (image upload, social preview generation)           â”‚
â”‚ â”œâ”€ /ocr/* (OCR parse endpoint â€” stub for Phase 2)              â”‚
â”‚ â”œâ”€ /reports/* (orders list, CSV export)                         â”‚
â”‚ â””â”€ /webhooks/* (email notifications async queue)                â”‚
â”‚                                                                  â”‚
â”‚ Middleware: Auth (JWT), Error handling, Logging                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼             â–¼                â–¼                  â–¼
PostgreSQL    S3 Storage      Email Queue    (Optional: WebSockets Phase 2)
(Entities)    (Images, Social  (SendGrid/     for real-time notifications
              Previews)        Twilio)
```

---

## API Contracts (High-Level)

All endpoints return JSON with status codes 200, 400, 401, 404, 422, 500. Error responses include error code and user-friendly message. Full OpenAPI schema in `contracts/api.openapi.yaml`.

**Core Endpoints** (MVP):
- `POST /auth/signup` â€” Seller email/password signup
- `POST /auth/login` â€” Email/password login (returns JWT)
- `GET /auth/me` â€” Current user info
- `POST /businesses` â€” Create business profile
- `GET /businesses/{id}` â€” Get business details
- `PUT /businesses/{id}` â€” Update business profile
- `GET /businesses/{id}/settings` â€” Delivery rules, payment info
- `PUT /businesses/{id}/settings` â€” Update settings
- `POST /dishes` â€” Create dish (auth required)
- `PUT /dishes/{id}` â€” Update dish
- `DELETE /dishes/{id}` â€” Delete dish
- `POST /menus` â€” Create menu (auth required)
- `GET /menus/{id}` â€” Get menu details (public, no auth)
- `PUT /menus/{id}` â€” Update menu (auth required)
- `GET /businesses/{id}/menu/current` â€” Get current active menu for business (public)
- `POST /orders` â€” Create order (public or auth)
- `GET /businesses/{id}/orders` â€” List orders (auth required)
- `PUT /orders/{id}` â€” Update order status/notes (auth required)
- `POST /media/upload` â€” Upload image, returns URL (auth required)
- `GET /media/social-preview/{menuId}` â€” Generate social preview image
- `GET /reports/orders` â€” Export orders (auth required, returns CSV)
- `POST /ocr/parse` â€” Submit image/text for OCR (future; stub for MVP)

See `contracts/api.openapi.yaml` for full schema.

---

## Mobile Architecture (Phase 3.5+)

### Overview
MenuMaker will extend beyond web PWA with native mobile apps for iOS and Android starting Phase 3.5 (Month 12â€“18). This section documents the mobile technology strategy and integration with existing backend.

### Technology Decision: React Native

**Rationale**:
1. **Code Sharing**: ~80% of UI/business logic shared across iOS and Android
2. **Team Efficiency**: Leverage existing React expertise; single mobile team instead of separate iOS/Android teams
3. **Time to Market**: 8â€“10 weeks to launch both platforms simultaneously (vs. 16â€“20 weeks native)
4. **Cost Efficiency**: 1 mobile developer vs. 2+ specialized developers
5. **Proven in Production**: Airbnb, Microsoft Teams, Shopify, Discord use React Native at scale

**Alternative Paths**: 
- **Flutter**: 100% code sharing in Dart, but smaller developer ecosystem
- **Native (Swift/Kotlin)**: Maximum performance & platform integration, but 2x cost & timeline
- **Cross-platform Web (PWA only)**: Covered by Phase 1; PWA remains primary for MVP

For detailed evaluation, see `mobile-architecture.md`.

### Mobile App Features

#### Feature Parity with Web PWA
- âœ… **Seller Features**: Onboarding, menu editor, order management, reporting, subscription tiers
- âœ… **Customer Features**: Marketplace discovery, menu browsing, checkout, order history, re-order
- âœ… **Payment Integration**: Same processors as web (Stripe, Razorpay, PhonePe)
- âœ… **Notifications**: Push notifications (FCM + APNs) for new orders, menu updates
- âœ… **Offline Support**: Orders cached locally, sync when online

#### Platform-Specific Features
- ðŸŽ **iOS**: Siri Shortcuts, App Clips, Home screen widgets, Apple Pay
- ðŸ¤– **Android**: Google Assistant shortcuts, Material You theming, Wear OS, Android Auto (future)

### Tech Stack (Mobile)

**React Native + Expo** (JavaScript/TypeScript):
```json
{
  "core": ["react-native", "expo"],
  "navigation": ["react-navigation", "@react-navigation/native"],
  "state": ["zustand"],
  "network": ["axios"],
  "storage": ["react-native-async-storage", "react-native-sqlite-storage"],
  "camera": ["react-native-vision-camera", "react-native-ml-kit"],
  "payment": ["react-native-stripe-sdk"],
  "notifications": ["react-native-firebase"],
  "maps": ["react-native-maps"],
  "testing": ["jest", "detox"]
}
```

**Native Bridges** (for performance-critical features):
- **iOS**: Swift (Xcode) for camera OCR, biometric auth
- **Android**: Kotlin (Android Studio) for camera OCR, biometric auth, offline sync

### Project Structure (Mobile)

```
menumaker-mobile/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/         # Seller + Customer UI screens (Seller Dashboard, Marketplace, etc.)
â”‚   â”œâ”€â”€ components/      # Reusable components (MenuCard, OrderItem, etc.)
â”‚   â”œâ”€â”€ services/        # API client, storage, camera (shared with web backend APIs)
â”‚   â”œâ”€â”€ store/          # Zustand state management
â”‚   â””â”€â”€ App.tsx         # Navigation entry point
â”œâ”€â”€ ios/                # Native Swift code for OCR, auth
â”œâ”€â”€ android/            # Native Kotlin code for OCR, auth
â”œâ”€â”€ tests/              # Jest unit + Detox E2E tests
â”œâ”€â”€ app.json            # Expo configuration
â”œâ”€â”€ eas.json            # Expo Application Services (builds)
â””â”€â”€ package.json
```

### Backend Integration (Shared)

**Same API Contract**: Mobile apps call identical `/api/v1/*` endpoints as web PWA
- No separate mobile backend needed
- Same database, same JWT authentication
- Same image storage (S3)

**Push Notifications**:
- Backend sends FCM (Android) + APNs (iOS) when new orders arrive
- No polling; real-time order delivery to sellers

**Offline Sync**:
- Mobile app caches orders, menu locally using SQLite
- Automatic sync when network restored (WorkManager on Android, Background Task on iOS)

### Rollout Timeline

| Phase | Timeline | Deliverables |
|-------|----------|--------------|
| **Setup** | Week 1â€“2 | React Native project, CI/CD, design system |
| **Auth & Core** | Week 3â€“7 | Signup, seller dashboard, menu editor, customer marketplace |
| **Advanced** | Week 8â€“9 | Camera OCR, notifications, offline sync, widgets |
| **QA & Beta** | Week 10â€“11 | Performance testing, bug fixes, TestFlight/Play Store beta |
| **Launch** | Week 12 | App Store submission, Google Play submission |

**Target**: Phase 3.5.1 starts Month 12 (after Phase 3 completes).

### Success Metrics (Mobile)

- âœ… 1,000+ downloads per platform by Month 2 post-launch
- âœ… 4.5+ star rating (100+ reviews)
- âœ… 99%+ crash-free user rate
- âœ… 70%+ push notification opt-in rate
- âœ… 20% monthly active user (MAU) engagement
- âœ… Feature parity with web PWA

### Out of Scope (Phase 3.5)

- Wear OS companion app (Phase 4+)
- Apple Watch app (Phase 4+)
- Augmented Reality menu (Phase 4+)
- Web3/blockchain features (undefined)

---

## Data Models

**Core Entities**:
- `User` (auth): id, email, password_hash, created_at
- `Business`: id, user_id (owner), name, slug, logo_url, primary_color, locale, timezone, created_at
- `Dish`: id, business_id, name, description, price_cents, currency, allergen_tags[], images[], created_at
- `Menu`: id, business_id, title, start_date, end_date, menu_items (dishes + qty/availability), status (draft/published), created_at
- `Order`: id, menu_id, customer_name, customer_phone, customer_email, delivery_type, delivery_address, items (dish_id + qty), total_cents, delivery_fee_cents, payment_method, payment_status, order_status (pending/confirmed/fulfilled), notes, created_at
- `Payout`: id, business_id, period_start, period_end, gross_amount_cents, net_amount_cents (manual), status (pending/completed), created_at
- `OrderNotification`: id, order_id, notification_type (email), recipient, status (pending/sent), retry_count, created_at

Full schema in `data-model.md`.

---

## Environment Configuration

**Secrets** (from .env):
```
DATABASE_URL=postgresql://user:pwd@localhost:5432/menumaker_dev
JWT_SECRET=<random 32-byte string>
S3_ENDPOINT=http://localhost:9000    # MinIO dev; AWS S3 prod
S3_BUCKET=menumaker-images
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
SENDGRID_API_KEY=<key>               # Phase 2
EMAIL_FROM=noreply@menumaker.app
FRONTEND_URL=http://localhost:3000   # CORS
```

---

## Development & Deployment

### Local Development
1. Clone repo & install deps (`npm install` in backend/ and frontend/)
2. Start services: `docker-compose up` (Postgres + MinIO)
3. Run migrations: `npm run migrate` (backend)
4. Start backend: `npm run dev` (Fastify on :3001)
5. Start frontend: `npm run dev` (Vite on :3000)
6. Open http://localhost:3000

### Staging & Production
- Repo pushed to GitHub; CI/CD runs tests + builds containers
- Deploy backend to Heroku/Render (or managed container service)
- Deploy frontend to Vercel (or same backend as static asset)
- Database: Heroku Postgres or Render Postgres
- Storage: MinIO (self-hosted) or AWS S3

### CI/CD Workflow
- PR: lint (ESLint), TypeScript check, unit tests, contract tests
- Merge to main: full test suite + deploy to staging
- Manual approval â†’ deploy to production

---

## Complexity Tracking

| Area | Choice | Trade-off |
|------|--------|-----------|
| **Auth** | JWT (no third-party) | More code to write; no social login MVP |
| **Payments** | Manual (no processor) | Simple MVP; deferred Stripe integration Phase 2 |
| **Frontend** | PWA (not native) | Smaller initial surface area; web-first MVP |
| **Image Generation** | Server-side (Node) | Phase 2: consider serverless (Cloudinary/Imgix) if load high |

---

## Success Criteria

- âœ… All acceptance criteria from spec.md met
- âœ… Tests pass (>70% coverage)
- âœ… E2E smoke tests pass (signup â†’ menu publish â†’ order)
- âœ… Performance: LCP < 2s, API p95 < 200ms
- âœ… Lighthouse score > 90 (desktop & mobile)
- âœ… Manual payment flow tested with 3+ sellers
- âœ… Docs & README updated for next dev

---

## Next Steps

1. **Generate research.md**: Resolve tech stack decisions (confirm Node 20 LTS, Fastify 4.x, React 19, etc.)
2. **Generate data-model.md**: Detailed entity definitions, relationships, validation rules
3. **Generate contracts/api.openapi.yaml**: Full OpenAPI v3 schema with examples
4. **Create tasks.md**: Task breakdown by user story (via `/speckit.tasks`)
5. **Setup local dev**: Docker compose, migrations, run tests
6. **Implement Phase 1**: Setup + foundational tasks (DB schema, auth middleware, base models)
7. **Iterate**: Complete user stories 1â€“7 in priority order

---

**Ready for**: `/speckit.plan` validation â†’ `/speckit.tasks` generation â†’ `/speckit.implement`
